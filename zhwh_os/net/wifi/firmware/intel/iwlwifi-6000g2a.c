/**
 * @file iwlwifi-6000g2a.c
 * @brief Intel Centrino Advanced-N 6205 WiFi 固件接口
 *
 * 固件文件: iwlwifi-6000g2a-6.ucode (真正的 Intel 固件)
 * 硬件: Intel Centrino Advanced-N 6205 AG
 * Vendor ID: 8086
 * Device ID: 0085 / 0082
 *
 * 模拟固件：符合 Intel TLV 格式的最小固件
 */

#include "types.h"

/**
 * @brief Intel TLV 固件头
 */
typedef struct {
    uint32_t magic;        // 0x4C575C49 ("IWL\" little-endian)
    uint32_t ver;          // 固件版本
    uint32_t build;        // 构建号
    uint8_t  human_readable[64];  // 版本字符串
} __attribute__((packed)) intel_tlv_header_t;

/**
 * @brief Intel TLV 条目
 */
typedef struct {
    uint32_t type;         // TLV 类型
    uint32_t length;       // 数据长度
    uint8_t  data[0];      // 可变长度数据
} __attribute__((packed)) intel_tlv_t;

// TLV 类型定义
#define IWL_UCODE_TLV_INST        1    // Runtime instructions
#define IWL_UCODE_TLV_DATA        2    // Runtime data
#define IWL_UCODE_TLV_INIT        3    // Init instructions
#define IWL_UCODE_TLV_INIT_DATA   4    // Init data

// 简化的 Intel 固件（TLV 格式，最小化）
static const uint8_t iwlwifi_6000g2a_6_fw[] = {
    // ========== TLV Header ==========
    // Magic: 0x0A4C5749 ("IWL\n" little-endian)
    // 字节序: I W L \n = 0x49 0x57 0x4C 0x0A
    0x49, 0x57, 0x4C, 0x0A,
    // Version: 0x11
    0x11, 0x00, 0x00, 0x00,
    // Build: 10000
    0x10, 0x27, 0x00, 0x00,
    // Human-readable: "6000g2a fw v18.168.6.1 build 0"
    0x36, 0x30, 0x30, 0x30, 0x67, 0x32, 0x61, 0x20,
    0x66, 0x77, 0x20, 0x76, 0x31, 0x38, 0x2E, 0x31,
    0x36, 0x38, 0x2E, 0x36, 0x2E, 0x31, 0x20, 0x62,
    0x75, 0x69, 0x6C, 0x64, 0x20, 0x30, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,

    // ========== TLV: INIT Instructions (Type=3) ==========
    0x03, 0x00, 0x00, 0x00,  // Type: 3 (IWL_UCODE_TLV_INIT)
    0x20, 0x00, 0x00, 0x00,  // Length: 32 bytes
    // INIT firmware data (32 bytes)
    0x00, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00,
    0x02, 0x00, 0x00, 0x00, 0x03, 0x00, 0x00, 0x00,
    0x04, 0x00, 0x00, 0x00, 0x05, 0x00, 0x00, 0x00,
    0x06, 0x00, 0x00, 0x00, 0x07, 0x00, 0x00, 0x00,
    0x08, 0x00, 0x00, 0x00, 0x09, 0x00, 0x00, 0x00,
    0x0A, 0x00, 0x00, 0x00, 0x0B, 0x00, 0x00, 0x00,
    0x0C, 0x00, 0x00, 0x00, 0x0D, 0x00, 0x00, 0x00,
    0x0E, 0x00, 0x00, 0x00, 0x0F, 0x00, 0x00, 0x00,
    // Padding to 4-byte alignment
    0x00, 0x00, 0x00, 0x00,

    // ========== TLV: RUNTIME Instructions (Type=1) ==========
    0x01, 0x00, 0x00, 0x00,  // Type: 1 (IWL_UCODE_TLV_INST)
    0x20, 0x00, 0x00, 0x00,  // Length: 32 bytes
    // RUNTIME firmware data (32 bytes)
    0x10, 0x00, 0x00, 0x00, 0x11, 0x00, 0x00, 0x00,
    0x12, 0x00, 0x00, 0x00, 0x13, 0x00, 0x00, 0x00,
    0x14, 0x00, 0x00, 0x00, 0x15, 0x00, 0x00, 0x00,
    0x16, 0x00, 0x00, 0x00, 0x17, 0x00, 0x00, 0x00,
    0x18, 0x00, 0x00, 0x00, 0x19, 0x00, 0x00, 0x00,
    0x1A, 0x00, 0x00, 0x00, 0x1B, 0x00, 0x00, 0x00,
    0x1C, 0x00, 0x00, 0x00, 0x1D, 0x00, 0x00, 0x00,
    0x1E, 0x00, 0x00, 0x00, 0x1F, 0x00, 0x00, 0x00,
    // Padding to 4-byte alignment
    0x00, 0x00, 0x00, 0x00,
};

const uint32_t iwlwifi_6000g2a_6_fw_size = sizeof(iwlwifi_6000g2a_6_fw);

#define IWLWIFI_FW_ENTRY 0x0000

// 导出固件数据接口
const uint8_t* intel_get_fw_data(void) {
    return iwlwifi_6000g2a_6_fw;
}

uint32_t intel_get_fw_size(void) {
    return iwlwifi_6000g2a_6_fw_size;
}

uint32_t intel_get_fw_entry(void) {
    return IWLWIFI_FW_ENTRY;
}
